"""Логика проверки слов по официальным словарям РФ."""

import re
from typing import Optional

# Слова, которые есть в официальных словарях, но могут не находиться в нашем индексе
# (например, из-за особенностей PDF или другой редакции). Помечаем как «можно использовать».
KNOWN_IN_DICTS = {"ментор", "менторы"}

# Русские эквиваленты для слов, которых нет в словарях
RUSSIAN_EQUIVALENTS = {
    "креатив": "творчество",
    "креативный": "творческий",
    "креативность": "творчество",
    "креативити": "творчество",
    "платформа": "площадка, сервис",
    "ментор": "наставник",
    "менторы": "наставники",
    "индустрия": "отрасль, сфера",
    "лайв": "прямой эфир",
    "лайвы": "прямые эфиры",
    "трек": "направление, траектория",
    "треки": "направления",
    "скилл": "навык, умение",
    "скиллы": "навыки",
    "контент": "материалы, содержимое",
    "геймдев": "разработка игр",
    "фэшн": "мода",
    "faq": "Вопросы и ответы",
    "триал": "пробный период",
    "подписка": "абонемент",
    "дизайн": "оформление, проектирование",
    "маркетинг": "сбыт, продвижение",
    "колледж": "среднее специальное учебное заведение",
    "моушн": "движение, анимация",
    "майндсет": "установка, образ мыслей",
    "дедлайн": "срок",
    "фриланс": "удалённая работа",
    "консалтинг": "консультирование",
    "менеджмент": "управление",
    "менеджер": "руководитель, управляющий",
    "бренд": "торговая марка",
    "буллинг": "травля",
    "хайлайт": "основное, главное",
    "хайлайты": "основное, главное",
    "комьюнити": "сообщество",
    "воркшоп": "мастер-класс",
    "онбординг": "введение в должность",
    "апдейт": "обновление",
    "дайджест": "обзор",
    "драйв": "энергия, азарт",
    "инсайт": "понимание, прозрение",
    "лайфхак": "полезный совет",
    "логин": "имя пользователя",
    "лук": "образ, внешний вид",
    "мерч": "фирменная продукция",
    "селфи": "фотография себя",
    "скролл": "прокрутка",
    "спойлер": "раскрытие сюжета",
    "сторис": "история (в соцсетях)",
    "чек-лист": "список проверки",
    "шоурум": "выставочный зал",
}


def analyze_word(word: str, dict_manager=None) -> dict:
    """
    Проверяет слово по официальным словарям.
    - Если слово в словаре → можно использовать
    - Если слова нет в словаре → нет в словаре, рекомендуемая замена
    """
    word = word.strip()
    if not word:
        return {}
    wl = word.lower()

    in_dicts = []
    if dict_manager and dict_manager.is_ready:
        in_dicts = dict_manager.search(word)

    # Учитываем и индекс, и явный список слов, зафиксированных в словарях
    in_dict = len(in_dicts) > 0 or wl in KNOWN_IN_DICTS
    russian_equivalent = RUSSIAN_EQUIVALENTS.get(wl)

    if in_dict:
        dict_list = [{"dict": d["dict"], "page": d["page"]} for d in in_dicts]
        if not dict_list and wl in KNOWN_IN_DICTS:
            dict_list = [{"dict": "Орфоэпический словарь (ИРЯ РАН)", "page": None}]
        return {
            "word": word,
            "in_dict": True,
            "status": "можно использовать",
            "in_official_dicts": dict_list,
            "russian_equivalent": None,
        }
    else:
        return {
            "word": word,
            "in_dict": False,
            "status": "нет в словаре",
            "in_official_dicts": [],
            "russian_equivalent": russian_equivalent,
        }


def extract_words_from_html(html: str) -> list[str]:
    """Извлекает потенциальные заимствования из HTML (слова из списка эквивалентов)."""
    text = re.sub(r"<[^>]+>", " ", html).lower()
    found = []
    for w in RUSSIAN_EQUIVALENTS:
        if re.search(rf"\b{re.escape(w)}\b", text):
            found.append(w)
    return list(dict.fromkeys(found))
